### Kubernetes Setup - Day 1 - Typical Task 3

# You should have a kubernetes cluster up and running (I have a k3s cluster)

kubectl get nodes

# Check prerequisites using the Longhorn command line tool
curl -sSfL https://raw.githubusercontent.com/longhorn/longhorn/v1.4.1/scripts/environment_check.sh | bash

Here's a simple **bash script** `k3s_deploy_longhorn.sh` to install longhorn storage system

### ðŸ“„ `k3s_deploy_longhorn.sh`

# Make sure you have kubectl and helm installed and all prerequisites met

# https://longhorn.io/docs/1.9.1/deploy/install/#installation-requirements

# I installed device mapper,  open-iscsi and nfs-common in case of Ubuntu:

apt-get install dmsetup
apt-get install open-iscsi
apt-get install nfs-common


# I have OpenSuse Leap 15 in the kubernetes as workers so I also installed required packages using zypper:

zypper install open-iscsi
zypper install nfs-client
zypper install device-mapper


# Checking Prerequisites Using Longhorn Command Line Tool

# For AMD64 platform
curl -sSfL -o longhornctl https://github.com/longhorn/cli/releases/download/v1.9.1/longhornctl-linux-amd64
# For ARM platform
curl -sSfL -o longhornctl https://github.com/longhorn/cli/releases/download/v1.9.1/longhornctl-linux-arm64

chmod +x longhornctl
./longhornctl check preflight

# Or you can Check prerequisites using a bash script:

https://raw.githubusercontent.com/longhorn/longhorn/v1.4.1/scripts/environment_check.sh

# Add the Longhorn Helm repository

helm repo add longhorn https://charts.longhorn.io

# Fetch the latest charts from the repository:

helm repo update

# Install longhorn version 1.9.1

helm install longhorn longhorn/longhorn --namespace longhorn-system --create-namespace --version 1.9.1

# Check the status of the Longhorn deployment

helm status longhorn -n longhorn-system

# You should also confirm the deployment via state of the pods are running or not
kubectl get pods -n longhorn-system

# Full instructions are also available on longhorn website:

https://longhorn.io/docs/1.9.1/deploy/install/#installation-requirements

# Github Repository

https://github.com/bwalia/devops.git